# URL Shortster
An API to shorten long URLs


## Technologies used
* **[Python3](https://www.python.org/downloads/)**
* **[Flask](flask.pocoo.org/)**
* **[MongoDB](https://www.mongodb.com/try/download/community)** 
* **[Redis](https://redis.io/download)** 
* **[Virtualenv](https://virtualenv.pypa.io/en/stable/)**


## Installation / Usage

* These instructions are for a Ubuntu system (specifically Ubuntu 18.04)

 #### Dependencies
* Please ensure that you have python3 installed, after which you may create a virtual environment, the steps are mentioned [here](https://naysan.ca/2019/08/05/install-python-3-virtualenv-on-ubuntu/).

* Git clone this repo to your PC
    ```
        $ git clone git@github.com:akaushik759/URLShortster.git
    ```

* Then proceed to install the dependencies from the requirements.txt, using the command below
    ```
        $ pip install -r requirements.txt
    ```
* Install Redis Server in your system, the steps are mentioned [here](https://linuxize.com/post/how-to-install-and-configure-redis-on-ubuntu-18-04/).

* Then in a new terminal start the Redis server by using the command below

    ```
        $ redis-server
    ```
* Incase it shows "Creating Server TCP listening socket :6379: bind: Address already in use" error, then this [article](https://stackoverflow.com/a/57087763/7821772) shall help you fix it

* After fixing any errors, the Redis server should be listening at localhost port 6379



 #### Setup and Running it
* In the project directory run the following commands
    ```
    (venv)$ export FLASK_APP=run.py
    (venv)$ export FLASK_DEBUG=1
    (venv)$ flask run
    ```
* The above commands will start the server at localhost port 5000

* I have avoided using environment variable since there weren't any sensitive personal keys, all are generic ids

 #### Testing
* On a new terminal, goto the tests folder and run the following commands:

* To test the /create endpoint
    ```
    (venv)$ pytest test_create_url.py -s
    ```
* To test the /< shortcode > endpoint
    ```
    (venv)$ pytest test_redirect_url.py -s
    ```
* To test the /< shortcode >/stats endpoint
    ```
    (venv)$ pytest test_stats_url.py -s
    ```
* To test the /< shortcode >/delete endpoint
    ```
    (venv)$ pytest test_delete_url.py -s
    ```

## API Endpoints

 #### Create a short url 
```
	1. /create

	POST - Used to create a short url with or without a custom url

	Input : original url(required), custom url (optional, length >=4)

	Header : {"Content-Type":"application/json; charset=utf-8"}
	
	Output : 
	Success - { 'status':'success', 
				'message':'', 
				'data': 
					{
						'_id':{'$oid':''},
						'original_url':'',
						'short_code':'',
						'timestamp':'',
						'unique_id':''
					}
				} 201
	Error - {'status':'error', 'message':''} 400/422/500

	Example :
	{
		"message": "successfully alloted short custom URL", 
  		"status": "success",
  		"data": {
    				"_id": {"$oid": "5fd703eaf90eaadea5810303"}, 
    				"original_url": "https://www.google.com", 
    				"short_code": "abcc", 
    				"timestamp": {"$date": 1607926757144}, 
    				"unique_id": "fuzRCRfewhztb2r7s8zScH"
  				}
  
	}
```
 #### Redirect using short url 
```
	1. /<shortcode>

	GET - Used to access the short url to get the original url

	Input : 
	
	Output : 
	Success - {'status':'success', 'message':'', 'data':} 200
	Error - {'status':'error', 'message':''} 400/500

	Example :
	{
		"message": "successfully found the original url", 
  		"status": "success",
  		"data": {
    				"original_url": "https://www.google.com"
  				},
  
	}
```
 #### Get stats of a short url
```
	1. /<shortcode>/stats

	GET - Used to get stats of a short url

	Input : 

	Header : {"Content-Type":"application/json; charset=utf-8", "unique_id":"<id>"}
	
	Output : 
	Success - {'status':'success', 'message':'', 'data':} 200
	Error - {'status':'error', 'message':''} 400/422/500

	Example :
	{
		"message": "successfully found the original url", 
  		"status": "success",
  		"data": {
    				"original_url": "https://www.google.com"
  				},
  
	}
```
 #### Delete short url
```
	1. /<shortcode>/delete

	DELETE - Used to delete the short url

	Input : 

	Header : {"Content-Type":"application/json; charset=utf-8", "unique_id":"<id>"}
	
	Output : 
	Success - {'status':'success', 'message':''} 200
	Error - {'status':'error', 'message':''} 400/422/500

	Example :
	{
		"message": "successfully deleted the url", 
  		"status": "success"
  
	}
```
## Database Schema
 
 #### URL Collection (Contains all the urls with their respective short urls)
 
```
Fields :
	_id - ObjectID (autogenerated)
	original_url - URL (required)
	short_code - string (required, unique)
	timestamp - datetime
	access_times - string
	unique_id - string (required)
```
 #### ShortURL Collection (Contains all short urls generated for use)
 
```
Fields :
	_id - ObjectID (autogenerated)
	short_code - string (required, unique)
	used - boolean (required)
```
## Algorithm / Explanation
